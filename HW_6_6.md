# Домашнее задание к занятию "6.6. Troubleshooting"

## Задание 1

CRUD операции, это аббревиатура от create, read, update, and delete. Отловить этот запрос нам поможет функция db.currentOp() с фильтром по продолжительности в секундах - db.currentOp({“secs_running”: {$gte: 180}}). Далее завершаем операцию с помощью функции db.killOp(<opId>). Чтобы исправить медленные запросы, нужно использовать explain(‘executionStats’) на запрос, возможно индексы не правильно настроены и запрос идет не в операвитную память а на жесткий диск.

## Задание 2
проблема в том, что одновременно закончилось TTL у многих ключей, а redis - однопоточный и не может принимать запросы, пока удаляет ключи с истёкшим сроком жизни. По сути, это означает, что если в базе данных много ключей, истекающих в одну и ту же секунду, и они составляют не менее 25% от текущей совокупности ключей с истекшим сроком действия. Тогда Redis блокирует обращения, пока не получит процент ключей (срок действия которых уже истек) ниже 25%.

## Задание 3

Ошибка Lost connection to MySQL server during query, возникает, если запрос не успел выполнится за определенный таймаут. Это возникает если запрос очень 
длинный или сложный в обработке. В таком случае нужно либо упростить запрос либо добавить времени на таймаут, изменив пременную - connect_timeout. Но это 
замедлит приложение.

## Задание 4

Эта ошибка означает, что ОС недостаточно памяти и система запустила процесс oom-killer, который завершит процесс потребляющий много памяти. Ему не нужно 
завершать процессы, которые используют мало памяти, а так же нужно завершить минимальное количество процессов. Чтобы не приходилось использовать OOM-Killer
для завершения Postgre, можно попробовать поиграть с параметрами Postgres, которые влияют на память (shared_buffer, wal_buffers, max_connections например) А лучше, если это возможно, добавить серверу памяти.



